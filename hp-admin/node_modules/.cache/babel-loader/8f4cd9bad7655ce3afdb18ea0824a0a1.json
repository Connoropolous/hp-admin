{"ast":null,"code":"import _slicedToArray from \"/home/lisa/Documents/gitrepos/holochain/holo/happyTeam/hp-admin/hp-admin/node_modules/@babel/runtime/helpers/esm/slicedToArray\";\nvar _jsxFileName = \"/home/lisa/Documents/gitrepos/holochain/holo/happyTeam/hp-admin/hp-admin/src/pages/holofuel/Inbox/Inbox.js\";\nimport _getClassName from \"babel-plugin-react-css-modules/dist/browser/getClassName\";\nconst _styleModuleImportMap = {\n  \"./Inbox.module.css\": {\n    \"transaction-list\": \"Inbox-module__transaction-list___v80Bo\",\n    \"transaction-row\": \"Inbox-module__transaction-row___1-leh\",\n    \"date-time\": \"Inbox-module__date-time___1OXIY\",\n    \"date\": \"Inbox-module__date___1pqcD\",\n    \"time\": \"Inbox-module__time___1KxKT\",\n    \"description-cell\": \"Inbox-module__description-cell___FnDmc\",\n    \"story\": \"Inbox-module__story___14Tpv\",\n    \"counterparty\": \"Inbox-module__counterparty___IuJ0X\",\n    \"notes\": \"Inbox-module__notes___3dhBv\",\n    \"amount\": \"Inbox-module__amount___24gsk\",\n    \"debit\": \"Inbox-module__debit___2lkbu\",\n    \"actions\": \"Inbox-module__actions___1swJL\",\n    \"button\": \"Inbox-module__button___rx-5R\",\n    \"accept-button\": \"Inbox-module__accept-button___1f-H8 Inbox-module__button___rx-5R\",\n    \"pay-button\": \"Inbox-module__pay-button___G2Lwl Inbox-module__button___rx-5R\",\n    \"reject-button\": \"Inbox-module__reject-button___2UgMM\",\n    \"modal\": \"Inbox-module__modal___3YKK2\",\n    \"modal-title\": \"Inbox-module__modal-title___3BvEG\",\n    \"modal-text\": \"Inbox-module__modal-text___ac50b\",\n    \"modal-counterparty\": \"Inbox-module__modal-counterparty___3wH_k\",\n    \"modal-amount\": \"Inbox-module__modal-amount___3VnwL\",\n    \"modal-buttons\": \"Inbox-module__modal-buttons___obeA9\",\n    \"modal-button\": \"Inbox-module__modal-button___2LTCR\",\n    \"modal-button-no\": \"Inbox-module__modal-button-no___1WxW_ Inbox-module__modal-button___2LTCR\",\n    \"modal-button-yes\": \"Inbox-module__modal-button-yes___11_BB Inbox-module__modal-button___2LTCR\"\n  }\n};\nimport React, { useState } from 'react';\nimport { useQuery, useMutation } from '@apollo/react-hooks';\nimport { isEmpty } from 'lodash/fp';\nimport moment from 'moment';\nvar HolofuelActionableTransactionsQuery = { kind: \"Document\", definitions: [{ kind: \"OperationDefinition\", operation: \"query\", name: { kind: \"Name\", value: \"HolofuelActionableTransactionsQuery\" }, variableDefinitions: [], directives: [], selectionSet: { kind: \"SelectionSet\", selections: [{ kind: \"Field\", name: { kind: \"Name\", value: \"holofuelActionableTransactions\" }, arguments: [], directives: [], selectionSet: { kind: \"SelectionSet\", selections: [{ kind: \"Field\", name: { kind: \"Name\", value: \"id\" }, arguments: [], directives: [] }, { kind: \"Field\", name: { kind: \"Name\", value: \"amount\" }, arguments: [], directives: [] }, { kind: \"Field\", name: { kind: \"Name\", value: \"counterparty\" }, arguments: [], directives: [] }, { kind: \"Field\", name: { kind: \"Name\", value: \"direction\" }, arguments: [], directives: [] }, { kind: \"Field\", name: { kind: \"Name\", value: \"status\" }, arguments: [], directives: [] }, { kind: \"Field\", name: { kind: \"Name\", value: \"type\" }, arguments: [], directives: [] }, { kind: \"Field\", name: { kind: \"Name\", value: \"timestamp\" }, arguments: [], directives: [] }, { kind: \"Field\", name: { kind: \"Name\", value: \"notes\" }, arguments: [], directives: [] }, { kind: \"Field\", name: { kind: \"Name\", value: \"fees\" }, arguments: [], directives: [] }] } }] } }], loc: { start: 0, end: 187, source: { body: \"query HolofuelActionableTransactionsQuery {\\n  holofuelActionableTransactions {\\n    id\\n    amount\\n    counterparty\\n    direction\\n    status\\n    type\\n    timestamp\\n    notes\\n    fees\\n  }\\n}\\n\", name: \"GraphQL request\", locationOffset: { line: 1, column: 1 } } } };\nvar HolofuelAcceptOfferMutation = { kind: \"Document\", definitions: [{ kind: \"OperationDefinition\", operation: \"mutation\", name: { kind: \"Name\", value: \"HolofuelAcceptOfferMutation\" }, variableDefinitions: [{ kind: \"VariableDefinition\", variable: { kind: \"Variable\", name: { kind: \"Name\", value: \"transactionId\" } }, type: { kind: \"NamedType\", name: { kind: \"Name\", value: \"ID\" } }, directives: [] }], directives: [], selectionSet: { kind: \"SelectionSet\", selections: [{ kind: \"Field\", name: { kind: \"Name\", value: \"holofuelAcceptOffer\" }, arguments: [{ kind: \"Argument\", name: { kind: \"Name\", value: \"transactionId\" }, value: { kind: \"Variable\", name: { kind: \"Name\", value: \"transactionId\" } } }], directives: [], selectionSet: { kind: \"SelectionSet\", selections: [{ kind: \"Field\", name: { kind: \"Name\", value: \"id\" }, arguments: [], directives: [] }, { kind: \"Field\", name: { kind: \"Name\", value: \"amount\" }, arguments: [], directives: [] }, { kind: \"Field\", name: { kind: \"Name\", value: \"counterparty\" }, arguments: [], directives: [] }, { kind: \"Field\", name: { kind: \"Name\", value: \"direction\" }, arguments: [], directives: [] }, { kind: \"Field\", name: { kind: \"Name\", value: \"status\" }, arguments: [], directives: [] }, { kind: \"Field\", name: { kind: \"Name\", value: \"type\" }, arguments: [], directives: [] }, { kind: \"Field\", name: { kind: \"Name\", value: \"timestamp\" }, arguments: [], directives: [] }] } }] } }], loc: { start: 0, end: 204, source: { body: \"mutation HolofuelAcceptOfferMutation ($transactionId: ID) {\\n  holofuelAcceptOffer(transactionId: $transactionId) {\\n    id\\n    amount\\n    counterparty\\n    direction\\n    status\\n    type\\n    timestamp\\n  }\\n}\\n\", name: \"GraphQL request\", locationOffset: { line: 1, column: 1 } } } };\nvar HolofuelOfferMutation = { kind: \"Document\", definitions: [{ kind: \"OperationDefinition\", operation: \"mutation\", name: { kind: \"Name\", value: \"HolofuelOfferMutation\" }, variableDefinitions: [{ kind: \"VariableDefinition\", variable: { kind: \"Variable\", name: { kind: \"Name\", value: \"counterparty\" } }, type: { kind: \"NamedType\", name: { kind: \"Name\", value: \"String\" } }, directives: [] }, { kind: \"VariableDefinition\", variable: { kind: \"Variable\", name: { kind: \"Name\", value: \"amount\" } }, type: { kind: \"NamedType\", name: { kind: \"Name\", value: \"Float\" } }, directives: [] }, { kind: \"VariableDefinition\", variable: { kind: \"Variable\", name: { kind: \"Name\", value: \"requestId\" } }, type: { kind: \"NamedType\", name: { kind: \"Name\", value: \"ID\" } }, directives: [] }], directives: [], selectionSet: { kind: \"SelectionSet\", selections: [{ kind: \"Field\", name: { kind: \"Name\", value: \"holofuelOffer\" }, arguments: [{ kind: \"Argument\", name: { kind: \"Name\", value: \"counterparty\" }, value: { kind: \"Variable\", name: { kind: \"Name\", value: \"counterparty\" } } }, { kind: \"Argument\", name: { kind: \"Name\", value: \"amount\" }, value: { kind: \"Variable\", name: { kind: \"Name\", value: \"amount\" } } }, { kind: \"Argument\", name: { kind: \"Name\", value: \"requestId\" }, value: { kind: \"Variable\", name: { kind: \"Name\", value: \"requestId\" } } }], directives: [], selectionSet: { kind: \"SelectionSet\", selections: [{ kind: \"Field\", name: { kind: \"Name\", value: \"id\" }, arguments: [], directives: [] }, { kind: \"Field\", name: { kind: \"Name\", value: \"amount\" }, arguments: [], directives: [] }, { kind: \"Field\", name: { kind: \"Name\", value: \"counterparty\" }, arguments: [], directives: [] }, { kind: \"Field\", name: { kind: \"Name\", value: \"direction\" }, arguments: [], directives: [] }, { kind: \"Field\", name: { kind: \"Name\", value: \"status\" }, arguments: [], directives: [] }, { kind: \"Field\", name: { kind: \"Name\", value: \"type\" }, arguments: [], directives: [] }, { kind: \"Field\", name: { kind: \"Name\", value: \"timestamp\" }, arguments: [], directives: [] }] } }] } }], loc: { start: 0, end: 265, source: { body: \"mutation HolofuelOfferMutation ($counterparty: String, $amount: Float, $requestId: ID) {\\n  holofuelOffer(counterparty: $counterparty, amount: $amount, requestId: $requestId) {\\n    id\\n    amount\\n    counterparty\\n    direction\\n    status\\n    type\\n    timestamp\\n  }\\n}\\n\", name: \"GraphQL request\", locationOffset: { line: 1, column: 1 } } } };\nvar HolofuelDeclineMutation = { kind: \"Document\", definitions: [{ kind: \"OperationDefinition\", operation: \"mutation\", name: { kind: \"Name\", value: \"HolofuelDeclineMutation\" }, variableDefinitions: [{ kind: \"VariableDefinition\", variable: { kind: \"Variable\", name: { kind: \"Name\", value: \"transactionId\" } }, type: { kind: \"NamedType\", name: { kind: \"Name\", value: \"ID\" } }, directives: [] }], directives: [], selectionSet: { kind: \"SelectionSet\", selections: [{ kind: \"Field\", name: { kind: \"Name\", value: \"holofuelDecline\" }, arguments: [{ kind: \"Argument\", name: { kind: \"Name\", value: \"transactionId\" }, value: { kind: \"Variable\", name: { kind: \"Name\", value: \"transactionId\" } } }], directives: [], selectionSet: { kind: \"SelectionSet\", selections: [{ kind: \"Field\", name: { kind: \"Name\", value: \"id\" }, arguments: [], directives: [] }, { kind: \"Field\", name: { kind: \"Name\", value: \"amount\" }, arguments: [], directives: [] }, { kind: \"Field\", name: { kind: \"Name\", value: \"counterparty\" }, arguments: [], directives: [] }, { kind: \"Field\", name: { kind: \"Name\", value: \"direction\" }, arguments: [], directives: [] }, { kind: \"Field\", name: { kind: \"Name\", value: \"status\" }, arguments: [], directives: [] }, { kind: \"Field\", name: { kind: \"Name\", value: \"type\" }, arguments: [], directives: [] }, { kind: \"Field\", name: { kind: \"Name\", value: \"timestamp\" }, arguments: [], directives: [] }] } }] } }], loc: { start: 0, end: 196, source: { body: \"mutation HolofuelDeclineMutation ($transactionId: ID) {\\n  holofuelDecline(transactionId: $transactionId) {\\n    id\\n    amount\\n    counterparty\\n    direction\\n    status\\n    type\\n    timestamp\\n  }\\n}\\n\", name: \"GraphQL request\", locationOffset: { line: 1, column: 1 } } } };\nimport { TYPE } from 'models/Transaction';\nimport Header from 'components/holofuel/Header';\nimport Button from 'components/holofuel/Button';\nimport Modal from 'components/holofuel/Modal';\nimport \"./Inbox.module.css\";\nimport cx from 'classnames';\n\nconst lastSix = counterparty => (counterparty || '').slice(-6);\n\nfunction useDecline() {\n  const _useMutation = useMutation(HolofuelDeclineMutation),\n        _useMutation2 = _slicedToArray(_useMutation, 1),\n        decline = _useMutation2[0];\n\n  return id => decline({\n    variables: {\n      transactionId: id\n    },\n    refetchQueries: [{\n      query: HolofuelActionableTransactionsQuery\n    }]\n  });\n}\n\nexport default function Inbox() {\n  const _useQuery = useQuery(HolofuelActionableTransactionsQuery),\n        _useQuery$data$holofu = _useQuery.data.holofuelActionableTransactions,\n        transactions = _useQuery$data$holofu === void 0 ? [] : _useQuery$data$holofu;\n\n  const declineTransaction = useDecline();\n\n  const _useState = useState(),\n        _useState2 = _slicedToArray(_useState, 2),\n        modalTransaction = _useState2[0],\n        setModalTransaction = _useState2[1];\n\n  const isTransactionsEmpty = isEmpty(transactions);\n  const pageTitle = \"Inbox\".concat(isTransactionsEmpty ? '' : \" (\".concat(transactions.length, \")\"));\n\n  const showRejectionModal = transaction => setModalTransaction(transaction);\n\n  return React.createElement(React.Fragment, {\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 38\n    },\n    __self: this\n  }, React.createElement(Header, {\n    title: pageTitle,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 39\n    },\n    __self: this\n  }), !isTransactionsEmpty && React.createElement(\"div\", {\n    className: \"Inbox-module__transaction-list___v80Bo\",\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 41\n    },\n    __self: this\n  }, transactions.map(transaction => React.createElement(TransactionRow, {\n    transaction: transaction,\n    showRejectionModal: showRejectionModal,\n    role: \"list\",\n    key: transaction.id,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 42\n    },\n    __self: this\n  }))), React.createElement(ConfirmRejectionModal, {\n    handleClose: () => setModalTransaction(null),\n    transaction: modalTransaction,\n    declineTransaction: declineTransaction,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 49\n    },\n    __self: this\n  }));\n}\n\nfunction presentDate(dateTime) {\n  const daysDifferent = moment().diff(dateTime, 'days');\n\n  if (daysDifferent < 1) {\n    return 'Today';\n  } else if (daysDifferent < 7) {\n    return dateTime.fromNow();\n  } else {\n    return dateTime.format('MMM D');\n  }\n}\n\nexport function TransactionRow({\n  transaction,\n  showRejectionModal\n}) {\n  const counterparty = transaction.counterparty,\n        amount = transaction.amount,\n        type = transaction.type,\n        timestamp = transaction.timestamp,\n        notes = transaction.notes;\n  const isOffer = type === TYPE.offer;\n  const isRequest = !isOffer;\n  const dateTime = moment(timestamp);\n  const date = presentDate(dateTime);\n  const time = dateTime.format('kk:mm');\n  const shortCounterparty = lastSix(counterparty);\n  const story = isOffer ? ' is offering' : ' is requesting';\n  return React.createElement(\"div\", {\n    className: \"Inbox-module__transaction-row___1-leh\",\n    role: \"listitem\",\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 83\n    },\n    __self: this\n  }, React.createElement(\"div\", {\n    className: \"Inbox-module__date-time___1OXIY\",\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 84\n    },\n    __self: this\n  }, React.createElement(\"div\", {\n    className: \"Inbox-module__date___1pqcD\",\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 85\n    },\n    __self: this\n  }, date), React.createElement(\"div\", {\n    className: \"Inbox-module__time___1KxKT\",\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 88\n    },\n    __self: this\n  }, time)), React.createElement(\"div\", {\n    className: \"Inbox-module__description-cell___FnDmc\",\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 92\n    },\n    __self: this\n  }, React.createElement(\"div\", {\n    className: \"Inbox-module__story___14Tpv\",\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 93\n    },\n    __self: this\n  }, React.createElement(\"span\", {\n    className: \"Inbox-module__counterparty___IuJ0X\",\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 93\n    },\n    __self: this\n  }, shortCounterparty), story), React.createElement(\"div\", {\n    className: \"Inbox-module__notes___3dhBv\",\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 94\n    },\n    __self: this\n  }, notes)), React.createElement(\"div\", {\n    className: _getClassName(cx('amount', {\n      debit: isRequest\n    }), _styleModuleImportMap),\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 96\n    },\n    __self: this\n  }, Number(amount).toLocaleString(), \" HF\"), React.createElement(\"div\", {\n    className: \"Inbox-module__actions___1swJL\",\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 97\n    },\n    __self: this\n  }, isOffer && React.createElement(AcceptButton, {\n    transaction: transaction,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 98\n    },\n    __self: this\n  }), isRequest && React.createElement(PayButton, {\n    transaction: transaction,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 99\n    },\n    __self: this\n  }), React.createElement(RejectButton, {\n    transaction: transaction,\n    showRejectionModal: showRejectionModal,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 100\n    },\n    __self: this\n  })));\n} // these are pulled out into custom hooks ready for if we need to move them to their own file for re-use elsewhere\n\nfunction useAcceptOffer(id) {\n  const _useMutation3 = useMutation(HolofuelAcceptOfferMutation),\n        _useMutation4 = _slicedToArray(_useMutation3, 1),\n        acceptOffer = _useMutation4[0];\n\n  return () => acceptOffer({\n    variables: {\n      transactionId: id\n    },\n    refetchQueries: [{\n      query: HolofuelActionableTransactionsQuery\n    }]\n  });\n}\n\nfunction AcceptButton({\n  transaction: {\n    id\n  }\n}) {\n  const acceptOffer = useAcceptOffer(id);\n  return React.createElement(Button, {\n    onClick: acceptOffer,\n    className: \"Inbox-module__accept-button___1f-H8 Inbox-module__button___rx-5R\",\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 118\n    },\n    __self: this\n  }, \"Accept\");\n}\n\nfunction useOffer(id, amount, counterparty) {\n  const _useMutation5 = useMutation(HolofuelOfferMutation),\n        _useMutation6 = _slicedToArray(_useMutation5, 1),\n        offer = _useMutation6[0];\n\n  return () => offer({\n    variables: {\n      amount,\n      counterparty,\n      requestId: id\n    },\n    refetchQueries: [{\n      query: HolofuelActionableTransactionsQuery\n    }]\n  });\n}\n\nfunction PayButton({\n  transaction: {\n    id,\n    amount,\n    counterparty\n  }\n}) {\n  const pay = useOffer(id, amount, counterparty);\n  return React.createElement(Button, {\n    onClick: pay,\n    className: \"Inbox-module__pay-button___G2Lwl Inbox-module__button___rx-5R\",\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 137\n    },\n    __self: this\n  }, \"Pay\");\n}\n\nfunction RejectButton({\n  showRejectionModal,\n  transaction\n}) {\n  return React.createElement(Button, {\n    onClick: () => showRejectionModal(transaction),\n    className: \"Inbox-module__reject-button___2UgMM\",\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 145\n    },\n    __self: this\n  }, \"Reject\");\n}\n\nfunction ConfirmRejectionModal({\n  transaction,\n  handleClose,\n  declineTransaction\n}) {\n  if (!transaction) return null;\n  const id = transaction.id,\n        counterparty = transaction.counterparty,\n        amount = transaction.amount,\n        type = transaction.type;\n\n  const onYes = () => {\n    declineTransaction(id);\n    handleClose();\n  };\n\n  return React.createElement(Modal, {\n    contentLabel: \"Reject \".concat(type, \"?\"),\n    isOpen: !!transaction,\n    handleClose: handleClose,\n    className: \"Inbox-module__modal___3YKK2\",\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 161\n    },\n    __self: this\n  }, React.createElement(\"div\", {\n    className: \"Inbox-module__modal-title___3BvEG\",\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 166\n    },\n    __self: this\n  }, \"Are you sure?\"), React.createElement(\"div\", {\n    className: \"Inbox-module__modal-text___ac50b\",\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 167\n    },\n    __self: this\n  }, \"Reject \", React.createElement(\"span\", {\n    className: \"Inbox-module__modal-counterparty___3wH_k\",\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 168\n    },\n    __self: this\n  }, lastSix(counterparty)), \"'s \", type, \" of \", React.createElement(\"span\", {\n    className: \"Inbox-module__modal-amount___3VnwL\",\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 168\n    },\n    __self: this\n  }, Number(amount).toLocaleString(), \" HF\"), \"?\"), React.createElement(\"div\", {\n    className: \"Inbox-module__modal-buttons___obeA9\",\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 170\n    },\n    __self: this\n  }, React.createElement(Button, {\n    onClick: handleClose,\n    className: \"Inbox-module__modal-button-no___1WxW_ Inbox-module__modal-button___2LTCR\",\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 171\n    },\n    __self: this\n  }, \"No\"), React.createElement(Button, {\n    onClick: onYes,\n    className: \"Inbox-module__modal-button-yes___11_BB Inbox-module__modal-button___2LTCR\",\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 176\n    },\n    __self: this\n  }, \"Yes\")));\n}","map":{"version":3,"sources":["/home/lisa/Documents/gitrepos/holochain/holo/happyTeam/hp-admin/hp-admin/src/pages/holofuel/Inbox/Inbox.js"],"names":["React","useState","useQuery","useMutation","isEmpty","moment","TYPE","Header","Button","Modal","cx","lastSix","counterparty","slice","useDecline","HolofuelDeclineMutation","decline","id","variables","transactionId","refetchQueries","query","HolofuelActionableTransactionsQuery","Inbox","data","holofuelActionableTransactions","transactions","declineTransaction","modalTransaction","setModalTransaction","isTransactionsEmpty","pageTitle","length","showRejectionModal","transaction","map","presentDate","dateTime","daysDifferent","diff","fromNow","format","TransactionRow","amount","type","timestamp","notes","isOffer","offer","isRequest","date","time","shortCounterparty","story","debit","Number","toLocaleString","useAcceptOffer","HolofuelAcceptOfferMutation","acceptOffer","AcceptButton","useOffer","HolofuelOfferMutation","requestId","PayButton","pay","RejectButton","ConfirmRejectionModal","handleClose","onYes"],"mappings":"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","sourcesContent":["import React, { useState } from 'react'\nimport { useQuery, useMutation } from '@apollo/react-hooks'\nimport { isEmpty } from 'lodash/fp'\nimport moment from 'moment'\nimport HolofuelActionableTransactionsQuery from 'graphql/HolofuelActionableTransactionsQuery.gql'\nimport HolofuelAcceptOfferMutation from 'graphql/HolofuelAcceptOfferMutation.gql'\nimport HolofuelOfferMutation from 'graphql/HolofuelOfferMutation.gql'\nimport HolofuelDeclineMutation from 'graphql/HolofuelDeclineMutation.gql'\nimport { TYPE } from 'models/Transaction'\nimport Header from 'components/holofuel/Header'\nimport Button from 'components/holofuel/Button'\nimport Modal from 'components/holofuel/Modal'\nimport './Inbox.module.css'\nimport cx from 'classnames'\n\nconst lastSix = counterparty => (counterparty || '').slice(-6)\n\nfunction useDecline () {\n  const [decline] = useMutation(HolofuelDeclineMutation)\n  return id => decline({\n    variables: { transactionId: id },\n    refetchQueries: [{\n      query: HolofuelActionableTransactionsQuery\n    }]\n  })\n}\n\nexport default function Inbox () {\n  const { data: { holofuelActionableTransactions: transactions = [] } } = useQuery(HolofuelActionableTransactionsQuery)\n  const declineTransaction = useDecline()\n  const [modalTransaction, setModalTransaction] = useState()\n  const isTransactionsEmpty = isEmpty(transactions)\n\n  const pageTitle = `Inbox${isTransactionsEmpty ? '' : ` (${transactions.length})`}`\n\n  const showRejectionModal = transaction => setModalTransaction(transaction)\n\n  return <React.Fragment>\n    <Header title={pageTitle} />\n\n    {!isTransactionsEmpty && <div styleName='transaction-list'>\n      {transactions.map(transaction => <TransactionRow\n        transaction={transaction}\n        showRejectionModal={showRejectionModal}\n        role='list'\n        key={transaction.id} />)}\n    </div>}\n\n    <ConfirmRejectionModal\n      handleClose={() => setModalTransaction(null)}\n      transaction={modalTransaction}\n      declineTransaction={declineTransaction} />\n\n  </React.Fragment>\n}\n\nfunction presentDate (dateTime) {\n  const daysDifferent = moment().diff(dateTime, 'days')\n  if (daysDifferent < 1) {\n    return 'Today'\n  } else if (daysDifferent < 7) {\n    return dateTime.fromNow()\n  } else {\n    return dateTime.format('MMM D')\n  }\n}\n\nexport function TransactionRow ({ transaction, showRejectionModal }) {\n  const { counterparty, amount, type, timestamp, notes } = transaction\n\n  const isOffer = type === TYPE.offer\n  const isRequest = !isOffer\n\n  const dateTime = moment(timestamp)\n\n  const date = presentDate(dateTime)\n  const time = dateTime.format('kk:mm')\n\n  const shortCounterparty = lastSix(counterparty)\n\n  const story = isOffer ? ' is offering' : ' is requesting'\n\n  return <div styleName='transaction-row' role='listitem'>\n    <div styleName='date-time'>\n      <div styleName='date'>\n        {date}\n      </div>\n      <div styleName='time'>\n        {time}\n      </div>\n    </div>\n    <div styleName='description-cell'>\n      <div styleName='story'><span styleName='counterparty'>{shortCounterparty}</span>{story}</div>\n      <div styleName='notes'>{notes}</div>\n    </div>\n    <div styleName={cx('amount', { debit: isRequest })}>{Number(amount).toLocaleString()} HF</div>\n    <div styleName='actions'>\n      {isOffer && <AcceptButton transaction={transaction} />}\n      {isRequest && <PayButton transaction={transaction} />}\n      <RejectButton transaction={transaction} showRejectionModal={showRejectionModal} />\n    </div>\n  </div>\n}\n\n// these are pulled out into custom hooks ready for if we need to move them to their own file for re-use elsewhere\nfunction useAcceptOffer (id) {\n  const [acceptOffer] = useMutation(HolofuelAcceptOfferMutation)\n  return () => acceptOffer({\n    variables: { transactionId: id },\n    refetchQueries: [{\n      query: HolofuelActionableTransactionsQuery\n    }]\n  })\n}\n\nfunction AcceptButton ({ transaction: { id } }) {\n  const acceptOffer = useAcceptOffer(id)\n  return <Button\n    onClick={acceptOffer}\n    styleName='accept-button'>\n    Accept\n  </Button>\n}\n\nfunction useOffer (id, amount, counterparty) {\n  const [offer] = useMutation(HolofuelOfferMutation)\n  return () => offer({\n    variables: { amount, counterparty, requestId: id },\n    refetchQueries: [{\n      query: HolofuelActionableTransactionsQuery\n    }]\n  })\n}\n\nfunction PayButton ({ transaction: { id, amount, counterparty } }) {\n  const pay = useOffer(id, amount, counterparty)\n  return <Button\n    onClick={pay}\n    styleName='pay-button'>\n    Pay\n  </Button>\n}\n\nfunction RejectButton ({ showRejectionModal, transaction }) {\n  return <Button\n    onClick={() => showRejectionModal(transaction)}\n    styleName='reject-button'>\n    Reject\n  </Button>\n}\n\nfunction ConfirmRejectionModal ({ transaction, handleClose, declineTransaction }) {\n  if (!transaction) return null\n\n  const { id, counterparty, amount, type } = transaction\n  const onYes = () => {\n    declineTransaction(id)\n    handleClose()\n  }\n\n  return <Modal\n    contentLabel={`Reject ${type}?`}\n    isOpen={!!transaction}\n    handleClose={handleClose}\n    styleName='modal'>\n    <div styleName='modal-title'>Are you sure?</div>\n    <div styleName='modal-text'>\n      Reject <span styleName='modal-counterparty'>{lastSix(counterparty)}</span>'s {type} of <span styleName='modal-amount'>{Number(amount).toLocaleString()} HF</span>?\n    </div>\n    <div styleName='modal-buttons'>\n      <Button\n        onClick={handleClose}\n        styleName='modal-button-no'>\n        No\n      </Button>\n      <Button\n        onClick={onYes}\n        styleName='modal-button-yes'>\n        Yes\n      </Button>\n    </div>\n  </Modal>\n}\n"]},"metadata":{},"sourceType":"module"}